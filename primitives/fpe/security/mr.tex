%!TEX root = ../fpe.tex

\heading{Message Recovery.}
The other primary security notion considered significant for FPE schemes is that of message recovery (MR), mainly because of the practical reasons one would use FPE (i.e. to prevent adversaries from being able to decrypt real-world data).\

 MR is formalized by the game $\gMR{}$ shown in \figref{fig-fpe-mr}, associated to FPE scheme $\FPE$ and adversary $\advA$. The game $\gMR{}$ randomly generates a key, message, and tweak, and then encrypts the message. \
 
 If an adversary $\advA$ is the current player $P$ of the game, it is given the ciphertext of the target message and asked to determine what the target message is. In attempting to do so, it may call an encryption oracle on pairs of messages and tweaks. \
 
 If the player of the game $P$ is instead a simulator $\sampS$, the simulator is not given the ciphertext of the target message and may only call on the $\EqO$ oracle to check whether a particular guess of the target message is correct. 
 
 The advantage of the adversary in breaking the mr security of $\FPE$ is determined by how well it guesses the target message compared to the simulator when they make the same number of queries to their respective oracles. In other words, the advantage is defined as $\mrAdv{\FPE}{\advA} = \Pr[\gMR{\FPE}(\advA)]- \max_{\sampS}\Pr[\gMR{\FPE}(\sampS)]$, where $\max_{\sampS}\Pr[\gMR{\FPE}(\sampS)]$ is basically the best a simulator can do, i.e. the highest probability of guessing the target message across all possible simulators.

\begin{figure} [t]
\begin{center}
\fbox
{
\begin{pchstack}
\procedure{Game $\gMR{\FPE}(P)$}
  {
    \key \getsr \Kg{\FPE}(\secIn)  \\
    X^* \getsr \Dom{\FPE}\\
    \nonce^* \getsr \NS{\FPE}\\
	Y^* \gets \Enc{\FPE}(\key, \nonce^*, X^*)\\
    \pcif (P = A) \pcthen \\
      \t X \getsr \advA(\secIn, Y^*)  \\
    \pcelseif (P = S) \pcthen \\
      \t X \getsr \sampS()  \\
    \pcreturn (X = X^*)
  }
  
    \pchspace
    
\procedure{Oracle $\EncO(\nonce,\msg)$}
  {
    Y\gets \Enc{\FPE}(\key,\nonce,\msg)  \\
    \pcreturn Y
  }
  
\procedure{Oracle $\EqO(\msg)$}
  {
    \pcreturn (M = X^*)
  }
\end{pchstack}
}
\end{center}
\vspace{-2ex}
\caption{ Game defining mr security of format-preserving encryption scheme $\FPE$.}
\label{fig-fpe-mr}
\hrulefill
\end{figure}